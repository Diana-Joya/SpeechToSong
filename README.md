# SpeechToSong

This application utilizes Speech-to-Text deep learning methods to convert speech input from the user into a string that will be used by the Genius API to find a song which contains such words. Once a song is found by the Genius API, the song and artist returned will be used to search the song in the Spofity API so it can be played for the user. 

## Demo

A demo of this project can be viewed starting at minute 04:15 here: https://www.youtube.com/watch?v=yrBIzegxFpw&t=273s
![Home Page](https://github.com/Diana-Joya/SpeechToSong/blob/master/Demo/Home.JPG)
![Results Page](https://github.com/Diana-Joya/SpeechToSong/blob/master/Demo/Results.JPG)

## Setup

To run this project, you'll need the following:
- Spotify Client Id & Client Secret

  To get a Spotify Client Id & Secret, you can follow the instructions provided by the following website: 
  https://developer.spotify.com/dashboard/
  Once you've acquired your client Id & secret, you must replace the authentication strings in lines 57 and 58 of the 
  IntegrateAPIs.py file.
- Genius Access Token

  To get a Genius Access Token, you can follow the instructions provided by the following website:
  https://docs.genius.com/
  Once you've acquired your access token, you must replace the authentication string in line 8 of the IntegrateAPIs.py file.
- Flask

  To run this project, you will need to have Flask installed in your local machine. If you don't have Flask, you can follow the
  installation instructions provided by the Flask documentation: https://flask.palletsprojects.com/en/1.1.x/

## Getting Started

The SpeechToSong repository contains the files needed to run a) the SpeechToSong web application developed using Python's SpeechRecognizer library, and b) The Speech to Text Training files to develop a simple small-scale speech to text training model for one word commands. 

### a) SpeechToSong Web Application
#### Python Packages: 
SpeechToSong utilizes the following Python libraries:
- Flask
- SpeechRecognition
- Spotipy
- Requests
- Sounddevice & Soundfile

#### Installing:

1. In the main page of the repository, use the dropdown menu to 'clone or download' the repository. 
2. Once you have the files in your local machine, make sure to update the IntegrateAPIs.py file with your Spotify and Genius authentication keys. 
3. Run the **speech_to_song.py** file.
   A window should pop up with the following information:
```
* Serving Flask app "speech_to_song" (lazy loading)
* Enviroment: production
WARNING: This is a development server. Do not use it in a production deployment.
Use a production WSGI server instead.
* Debug mode: on
* Restarting with stat

* Debuger is active!
* Debugger PIN: 307-145-361
* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```
4. Run the localhost address ( http://127.0.0.1:5000/ ) in your preferred browser.

**Note: You MUST have added your own Genius and Spotify keys to the IntegrateAPIs.py file or the project will NOT run!**

### b) Speech to Text Training
#### Python Packages: 
Speech To Text Training utilizes the following Python libraries:
- Tensorflow
- Keras
- librosa
- sklearn

#### Setup:
1. Make sure you have the required python packages installed in your IDE. To create this project, I used PyCharm 2019.2.3 and Python 3.6.
2. Download the data set from Kaggle ( https://www.kaggle.com/c/tensorflow-speech-recognition-challenge/data ). Then replace the contents inside 'speech to text training/training_data_set/' with the files inside the Kaggle data set folder. 
3. Run 'training_model.py' to train the speech to text model. 

#### Testing the Model:
1. After training the model, run 'test_prediction.py'. A random interger will serve as the index to pick an audio file from the data set, then the application will compare it's prediction with the actual audio file label.


## Functional File Descriptions:
- **speech_to_song.py**: Contains the main Flask code required to run the SpeechToSong web application.
- **speech_to_text.py**: Contains the speech_to_text() function required to predict the speech to text input generated by the user using Python's Speech Recognizer.
- **get_voice_command.py**: Contains functions required to record and process user's speech input.
- **IntegrateAPIs.py**: Contains functions needed to authenticate the Genius and Spotify APIs. 
  genius_request(query, access_token, base_url): Receives authenticated genius token and base url, and speech to text input query,   
  returns a the most popular song (and its artist) that contains the query within its lyrics as found by the Genius API.
  spotify_request(artist, song_title, token): Receives spotify authentication token, as well as artist and song title found by the
  Genius API. It uses normalize_str() to ensure both the song title sent by Genius as well as the song title found by Spotify have
  normalized matching characters. Returns first instance of the song if found within 50 most popular songs by the input song's artist. 
- **voice_commands folder**: Stores most recently recorded user input.
- **templates folder**: Stores html templates used by the Flask application.
- **static folder**: Stores css styles and multimedia such as application backgrounds.
- **speech to text training folder**:
  - **training data set**: In this repository, it stores only a hyperlink to the Kaggle simple speech command dataset. Because of the
    data set's size, I decided not to include it but make it easy for the user to download and add to the application if they'd like
    to try using the speech to text model.
  - **audio_preprocessing.py**: Contains functions used to preprocess training audio files by performing resampling and saving 
    processed labels and waves as npy arrays. 
  - **encode_labels.py**: Encondes preprocessed labels and prepares data set for training. 
  - **training_model.py**: Performs deep learning speech recognition model training. Performs 4 layers of 1 dimensional convolution, 
    2 fully connected layers, then the model is compiled using adam optimizer, and fit for 100 epochs with early stopping by measuring
    validation loss.
  - **speech_prediction.py**: Predicts audio input based on best model found by training_model.py.
  - **test_prediction.py**: Selects random audio file from data set, performs speech recognition prediction and compares the file's
    label with the performed prediction. 
  - **speech_to_text_best_model.hdf5**: Best model found by training_model.py.

## Others

For more information on:

- **Genius API:** https://docs.genius.com/#/getting-started-h1
- **Spotify API:** https://developer.spotify.com/

### Note: 
This application is a student project for CPSC 481 - Artificial Intelligence 

